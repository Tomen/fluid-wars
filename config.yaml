# Fluid Wars Configuration
# All game settings in one place

# =============================================================================
# GAME SETUP
# =============================================================================
game:
  playerCount: 8
  particlesPerPlayer: 200
  # Canvas size is now dynamic based on window size (see renderer.ts)
  canvasWidth: 1600
  canvasHeight: 900

  # Win condition for regular play
  win:
    mode: percentage       # 'elimination' or 'percentage'
    eliminationThreshold: 0   # particles - opponent must have this many or fewer to lose
    percentageThreshold: 0.85 # ratio - control this percentage to win (percentage mode)

# =============================================================================
# PARTICLE PHYSICS
# See docs/GAME_BALANCE.md for how these interact with conversion parameters
# =============================================================================
particle:
  # Movement
  acceleration: 400      # units/sec² - how fast particles accelerate toward cursor
  maxVelocity: 800       # units/sec - maximum particle speed
                         # BALANCE: affects escape ratio (maxVelocity × conversionTime / conversionRadius)
  friction: 0.98         # per frame - velocity decay (0.98 = 2% loss per frame)

  # Size
  radius: 8              # pixels - visual size of particles

  # Collision and Repulsion
  repulsionRadius: 24    # pixels - distance at which particles repel each other
                         # BALANCE: should be < conversion.radius for conversion to work
  repulsionStrength: 1000 # force units - base repulsion force
  enemyRepulsionMultiplier: 4.0  # multiplier - extra repulsion between enemy particles
                         # BALANCE: higher = attackers spread more, harder to outnumber defenders
                         # TIP: reduce to 4-5 if corner camping is too strong
  friendlyRepulsionMultiplier: 8.0  # multiplier - repulsion between same-owner particles
                         # BALANCE: higher = friendlies spread out more, less compression
  collisionDamping: 2.0  # per second - velocity loss when particles collide (at point-blank)
                         # BALANCE: higher = particles lose more energy on collision

  # Spawn
  spawnRadius: 150       # pixels - radius around player cursor where particles spawn

# =============================================================================
# CONVERSION SYSTEM
# See docs/GAME_BALANCE.md for how these interact with particle parameters
# =============================================================================
conversion:
  radius: 45             # pixels - distance at which conversion can occur
                         # BALANCE: should be > particle.repulsionRadius for conversion to work
  rate: 3.0              # progress/sec - how fast conversion builds up when outnumbered
                         # BALANCE: conversionTime = threshold / rate (currently 0.5 sec)
  threshold: 1.0         # progress required to convert
  decayMultiplier: 2     # decay rate multiplier when not being converted
                         # BALANCE: higher = defenders recover faster (currently 2x)
  friendlySupportFactor: 1  # how much nearby friends help defend (1.0 = full, 0.5 = half)
                         # BALANCE: defenderAdvantage = 1/factor (currently 1.43x)
                         # Formula: conversion triggers when enemies > friends × factor

# =============================================================================
# PLAYER CONTROLS
# =============================================================================
player:
  cursorSpeed: 300       # units/sec - how fast cursors move with keyboard
  cursorRadius: 8        # pixels - visual size of cursor

# =============================================================================
# SPATIAL HASH (Performance)
# =============================================================================
spatial:
  cellSize: 50           # pixels - size of spatial hash grid cells

# =============================================================================
# OBSTACLES / MAZE
# =============================================================================
obstacle:
  generator: 'grid'      # 'random' or 'grid' - which maze generator to use
  playerMargin: 150      # pixels - keep obstacles away from player spawns
  bounceEnergyLoss: 0.7  # multiplier - energy retained after bouncing (higher = less stuck on walls)

  # Random generator settings
  size: 40               # pixels - base size for obstacles
  minSizeMultiplier: 0.5 # multiplier - minimum size (0.5 = 50% of base)
  maxSizeMultiplier: 3   # multiplier - maximum size (5 = 500% of base)
  minCount: 25           # minimum number of obstacles
  maxCount: 40           # maximum number of obstacles
  margin: 100            # pixels - margin from canvas edges

  # Grid maze settings
  gridSpacing: 300       # pixels - distance between wall lines
  wallThickness: 30      # pixels - thickness of walls
  gapSize: 80            # pixels - size of gaps for passage
  wallProbability: 0.7   # probability of wall at each grid position

# =============================================================================
# GAME LOOP
# =============================================================================
gameLoop:
  fixedDt: 0.01666667    # seconds - physics timestep (1/60 = 60 FPS)
  maxAccumulator: 0.1    # seconds - prevent spiral of death

# =============================================================================
# AI CONFIGURATION
# =============================================================================
ai:
  enabled: true          # whether to use AI opponents
  # Which players are AI controlled (0-indexed)
  # Example: [1, 2, 3] means players 2, 3, 4 are AI
  aiPlayers: [1, 2, 3, 4, 5, 6, 7]
  # Default AI type: 'random', 'aggressive', or 'neural'
  defaultAIType: neural
  # Difficulty for neural AI: 'easy', 'medium', 'hard', 'expert'
  neuralDifficulty: easy
  # Use Web Worker for non-blocking AI (requires WASM backend)
  useWebWorker: true

# =============================================================================
# RENDERING
# =============================================================================
render:
  backgroundColor: '#0a0a0f'
  # Particle rendering style: 'solid', 'soft', or 'glow'
  # - solid: Hard circles (fastest, classic look)
  # - soft: Gradient circles that blend where they overlap
  # - glow: Same as soft but with additive blending (brighter overlaps)
  particleStyle: 'solid'
  # Soft/glow settings
  shadowBlur: 6              # multiplier - gradient extends this many times the particle radius
  shadowAlpha: 1.0           # unused, kept for compatibility

# =============================================================================
# CNN ARCHITECTURE
# =============================================================================
cnn:
  # Convolutional layers
  conv1Filters: 16           # First conv layer filters
  conv2Filters: 32           # Second conv layer filters
  kernelSize: 3              # Convolution kernel size
  denseUnits: 64             # Dense layer before output

  # Input grid dimensions (must match ObservationEncoder)
  gridRows: 20
  gridCols: 20
  channels: 5                # friendly, enemy, obstacles, friendlyVel, enemyVel

# =============================================================================
# TRAINING (used by npm run train)
# =============================================================================
training:
  # --- Genetic algorithm settings ---
  populationSize: 20          # Population size for evolution
  eliteCount: 3               # Top N kept unchanged each generation
  mutationRate: 0.15          # Probability of mutating each weight
  mutationStrength: 0.25      # Std dev of Gaussian noise for mutations
  crossoverRate: 0.6          # Probability of crossover vs mutation-only
  maxGenerations: 5000
  checkpointInterval: 1       # Save every N generations
  verbose: true

  # --- Evaluation settings ---
  matchesPerGenome: 3         # Matches per genome evaluation (reduces variance)
  maxGameSteps: 2400          # Steps per match (40 seconds at 60 FPS)
  stepsPerSecond: 60          # For calculating time bonus

  # --- Game overrides (inherits from game section, override specific values) ---
  # Only specify values you want to change from the base game config
  overrides:
    playerCount: 4              # Fewer players for faster training
    particlesPerPlayer: 100     # Fewer particles for faster simulation
    canvasWidth: 1200
    canvasHeight: 800
    win:
      mode: percentage       # 'elimination' or 'percentage'
      eliminationThreshold: 0   # particles - opponent must have this many or fewer to lose
      percentageThreshold: 0.65 # ratio - control this percentage to win (percentage mode)

  # --- Difficulty tiers (generations at which to save tiered models) ---
  difficultyTiers:
    easy: 25
    medium: 100
    hard: 250
    expert: 500
